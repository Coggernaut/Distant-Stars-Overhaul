namespace = dso_story
namespace = DSO_ancrel
### 5 - Remnants
country_event = {
	id = dso_story.5
	title = story.5.name
	# First
	desc = {
		trigger = {
			NOT = { has_country_flag = StoryFirst }
		}
		text = story.5.desc
	}
	# Gestalt Consciousness
	desc = {
		trigger = { is_gestalt = yes }
		text = story.5.desc.gesta
	}
	# Xenophobe
	desc = {
		trigger = { is_xenophobe = yes }
		text = story.5.desc.phobe
	}
	# Xenophile
	desc = {
		trigger = { is_xenophile = yes }
		text = story.5.desc.phile
	}
	# Followup
	desc = {
		trigger = {
			OR = {
				has_country_flag = Story1
				has_country_flag = Story2
				has_country_flag = Story3
				has_country_flag = Story4
			}
		}
		text = story.5.desc.followup
	}
	picture = GFX_evt_news_room
	show_sound = event_scanner
	is_triggered_only = yes
	trigger = {
		NOR = {
			has_country_flag = Story5
			has_country_flag = Story6
			has_country_flag = Story7
		}
	}
	immediate = {
		if = {
			limit = {
				NOT = { has_country_flag = StoryFirst }
			}
			set_country_flag = StoryFirst
		}
		if = {
			limit = {
				NOT = { has_country_flag = first_alien_life }
			}
			set_country_flag = first_alien_life
		}
		set_country_flag = Story5
	}
	option = { name = REMARKABLE }
	after = {
		hidden_effect = {
			country_event = { id = first_contact.1060 days = 10 random = 10 }
		}
	}
}

######################################
# Ancient Gray Tempest Micro-missles #
######################################
# TODO!!
# From = fleet?
country_event = {
	id = dso_story.6
	title = dso_story.6.name
	# First
	desc = {
		# trigger = {
		# 	OR = {
		# 		has_origin = civic_gateway_pursuer
		# 		has_origin = civic_harvester_nanites
		# 	}
		# }
		text = story.6.desc.nanite
	}
	# Gestalt Consciousness
	desc = {
		exclusive_trigger = {
			is_gestalt = yes
			NOT = {
				has_origin = civic_gateway_pursuer
				has_origin = civic_harvester_nanites
			}
		}
		text = story.6.desc.gesta
	}
	# Materialist
	desc = {
		trigger = { is_materialist = yes }
		text = story.6.desc.materialist
	}
	# Gateway Guardian
	desc = {
		trigger = { has_origin = civic_gateway_worshiper }
		text = story.6.desc.gateway_guardian
	}
	# other
	desc = {
		trigger = {
			NOR = {
				has_origin = civic_gateway_worshiper
				has_origin = civic_gateway_pursuer
				has_origin = civic_harvester_nanites
				is_gestalt = yes
				is_materialist = yes
			}
		}
		text = story.6.desc.followup
	}
	picture = GFX_evt_news_room
	show_sound = event_scanner
	is_triggered_only = yes
	trigger = { }
	immediate = { }
	option = { name = REMARKABLE }
	after = {
		hidden_effect = {
			country_event = { id = first_contact.1060 days = 10 random = 10 }
		}
	}
}

#
fleet_event = {
	id = DSO_ancrel.1
	title = "nanite_insight"
	desc = "DSO_ancrel.1.desc"
	picture = GFX_evt_drifting_gateway
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	option = {
		name = DSO_ancrel.1.a
	}
}
fleet_event = {
	id = DSO_ancrel.2
	title = "nanite_insight"
	desc = "DSO_ancrel.1.desc"
	picture = GFX_evt_drifting_gateway
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	option = {
		name = DSO_ancrel.1.a
	}
}
fleet_event = {
	id = DSO_ancrel.3
	title = "nanite_insight"
	desc = "DSO_ancrel.1.desc"
	picture = GFX_evt_drifting_gateway
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	option = {
		name = DSO_ancrel.1.a
		if = {
			limit = { has_ancrel = yes }
			owner = {
				add_tech_progress = { tech = tech_archaeo_missiles progress = 0.14 }
			}
		}
	}
}
fleet_event = {
	id = DSO_ancrel.4
	title = "nanite_insight"
	desc = "DSO_ancrel.1.desc"
	picture = GFX_evt_drifting_gateway
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	option = {
		name = DSO_ancrel.1.a
	}
}
fleet_event = {
	id = DSO_ancrel.5
	title = "nanite_insight"
	desc = "DSO_ancrel.1.desc"
	picture = GFX_evt_drifting_gateway
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	option = {
		name = DSO_ancrel.1.a
	}
}
#
fleet_event = {
	id = DSO_ancrel.6
	title = "nanite_insight"
	desc = "DSO_ancrel.2.desc"
	picture = GFX_evt_drifting_gateway
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	option = { name = DSO_ancrel.2.a }
}

#############################################
#Odd Factory Clone - Ancient Dessanu Factory#
#############################################
planet_event = {
	id = dso_story.2015
	title = dso_story.2015.name
	desc = {
		trigger = { NOT = { has_government = gov_spiritualist_gateway_worshiper } }
		text =dso_story.2015.desc
	}
	desc = {
		trigger = { has_government = gov_spiritualist_gateway_worshiper }
		text =dso_story.2015.desc_gateway_cult
	}
	picture = GFX_evt_alien_city
	show_sound = event_activating_unknown_technology
	location = root

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		is_occupied_flag = no
	}

	trigger = {
		owner = {
			NOR = {
				has_country_flag = dso_story_colony_odd_factory
				has_authority = auth_machine_intelligence
			}
		}
		num_pops > 0
		NOR = {
			has_planet_flag = colony_event
			is_planet_class = pc_ringworld_habitable
			is_planet_class = pc_shattered_ring_habitable
			is_planet_class = pc_habitat
		}
	}

	is_triggered_only = yes

	immediate = {
		set_planet_flag = colony_event
		owner = { set_country_flag = dso_story_colony_odd_factory }
		random_owned_pop = { unemploy_pop = yes }
		add_deposit = d_dessanu_relic_odd_factory
		random_list = {
			30 = { 
				if = { 
					limit = { has_government = gov_spiritualist_gateway_worshiper } 
					set_planet_flag = dso_story_colony_factory_no_effect
				}
				else = { set_planet_flag = dso_story_colony_factory_kidnap }
			}
			35 = { set_planet_flag = dso_story_colony_factory_no_effect }
		}
	}

	option = {
		name = INTRIGUING
		tooltip = { add_deposit = d_dessanu_relic_odd_factory }
	}
}
#Follow-up: Kidnap
planet_event = {
	id = dso_story.2016
	title = dso_story.2015.name
	desc = {
		trigger = { 
			NOT = {
				any_country = {
					has_established_contact = ROOT
					has_government = gov_spiritualist_gateway_worshiper
				}
			}
		}
		text =dso_story.2016.desc
	}
	desc = {
		trigger = { 
			any_country = {
				has_established_contact = ROOT
				has_government = gov_spiritualist_gateway_worshiper
			}
		}
		text =dso_story.2016.desc_gateway_cult
	}
	picture = GFX_evt_alien_city
	show_sound = event_ghost_town
	location = root

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
	}

	trigger = {
		has_planet_flag = dso_story_colony_factory_kidnap
		has_deposit = d_dessanu_relic_odd_factory
		num_assigned_jobs = {
			job = odd_factory_worker
			value >= 1
		}
	}

	mean_time_to_happen = {
		months = 4
	}

	immediate = {
		owner = { set_country_flag = odd_factory_pause }
		random_owned_pop = {
			limit = { has_job = odd_factory_worker }
			kill_pop = yes
		}
	}

	option = {
		name = dso_story.2016.b
		custom_tooltip = dso_story.2016.a.tooltip
		remove_deposit = d_dessanu_relic_odd_factory
		hidden_effect = {
			owner = { remove_country_flag = odd_factory_pause }
		}
	}

	option = {
		name = dso_story.2016.a
		custom_tooltip = dso_story.2016.a.tooltip
		hidden_effect = {
			remove_planet_flag = dso_story_colony_factory_kidnap
			owner = { remove_country_flag = odd_factory_pause }
			random_list = {
				50 = { set_planet_flag = dso_story_colony_factory_kidnap_sequel }
				50 = { set_planet_flag = dso_story_colony_factory_no_effect }
			}
		}
	}
}
#Follow-up: Kidnap 2
planet_event = {
	id = dso_story.2017
	title = dso_story.2015.name
	desc = dso_story.2017.desc
	picture = GFX_evt_alien_city
	show_sound = event_ghost_town
	location = root

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
	}

	trigger = {
		has_planet_flag = dso_story_colony_factory_kidnap_sequel
		has_deposit = d_dessanu_relic_odd_factory
		num_assigned_jobs = {
			job = odd_factory_worker
			value >= 1
		}
	}

	mean_time_to_happen = {
		months = 4
	}

	immediate = {
		owner = { set_country_flag = odd_factory_pause }
		random_owned_pop = {
			limit = { has_job = odd_factory_worker }
			kill_pop = yes
		}
	}

	option = {
		name = dso_story.2017.a
		custom_tooltip = dso_story.2017.a.tooltip
		add_modifier = {
			modifier = scared_population
			days = 1800
		}
		hidden_effect = {
			owner = { remove_country_flag = odd_factory_pause }
			remove_planet_flag = dso_story_colony_factory_kidnap_sequel
		}
	}
	option = {
		name = dso_story.2017.b
		custom_tooltip = dso_story.2017.b.tooltip
		add_modifier = {
			modifier = secured_factory
			days = 1800
		}
		hidden_effect = {
			owner = { remove_country_flag = odd_factory_pause }
			remove_planet_flag = dso_story_colony_factory_kidnap_sequel
		}
	}
}

#Follow-up: No effect
planet_event = {
	id = dso_story.2019
	title = dso_story.2015.name
	desc = dso_story.2019.desc
	picture = GFX_evt_alien_city
	show_sound = event_administrative_work
	location = root

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
	}

	trigger = {
		has_planet_flag = dso_story_colony_factory_no_effect
		has_deposit = d_dessanu_relic_odd_factory
		num_assigned_jobs = {
			job = odd_factory_worker
			value >= 1
		}
	}

	mean_time_to_happen = {
		months = 6
	}

	immediate = {
	}

	option = {
		name = GOOD
		hidden_effect = {
			remove_planet_flag = dso_story_colony_factory_no_effect
		}
	}
}
##Follow-up: Destroyed
#planet_event = {
#	id = dso_story.2020
#	title = dso_story.2015.name
#	desc = dso_story.2020.desc
#	picture = GFX_evt_burning_settlement
#	show_sound = event_structural_collapse
#	location = root
#
#	is_triggered_only = yes
#
#	trigger = {
#		NOT = { has_planet_flag = odd_factory_destroyed }
#	}
#
#	immediate = {
#		set_planet_flag = odd_factory_destroyed
#	}
#
#	option = {
#		name = dso_story.2018.a
#		add_deposit = d_odd_factory_wreckage_1
#		hidden_effect = {
#			remove_planet_flag = dso_story_colony_factory_found
#			remove_planet_flag = dso_story_colony_factory_no_effect
#			remove_planet_flag = dso_story_colony_factory_kidnap
#			remove_planet_flag = dso_story_colony_factory_kidnap_sequel
#			if = {
#				limit = {
#					has_modifier = secured_factory
#				}
#				remove_modifier = secured_factory
#			}
#			if = {
#				limit = {
#					has_modifier = scared_population
#				}
#				remove_modifier = scared_population
#			}
#		}
#	}
#	option = {
#		name = dso_story.2018.b
#		add_deposit = d_odd_factory_wreckage_2
#		hidden_effect = {
#			remove_planet_flag = dso_story_colony_factory_found
#			remove_planet_flag = dso_story_colony_factory_no_effect
#			remove_planet_flag = dso_story_colony_factory_breaks
#			remove_planet_flag = dso_story_colony_factory_kidnap
#			remove_planet_flag = dso_story_colony_factory_kidnap_sequel
#			if = {
#				limit = {
#					has_modifier = secured_factory
#				}
#				remove_modifier = secured_factory
#			}
#			if = {
#				limit = {
#					has_modifier = scared_population
#				}
#				remove_modifier = scared_population
#			}
#		}
#	}
#}