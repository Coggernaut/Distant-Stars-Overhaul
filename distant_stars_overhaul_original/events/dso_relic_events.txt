namespace = dso_story
namespace = DSO_ancrel

# Debug
country_event = {
	id = dso_story.1000
	title = ""
	desc = ""
	picture = GFX_evt_exploding_ship
	#show_sound = event_space_battle
	#event_chain = dso_story_dessanu_cult_schism

	is_triggered_only = yes

	option = {
		name = "GOOD"
		ROOT = {
			add_ship_design = Cult_of_The_Open_Gateway_Shipyard_01_key
			create_fleet = {
				name = "NAME_dessanu_cult_schism_Shipyard"
				effect = {
					set_owner = PREV
					create_ship = {
						name = "NAME_dessanu_cult_schism_Shipyard"
						design = Cult_of_The_Open_Gateway_Shipyard_01_key
					}
					set_location = random_owned_planet
				}
			}
		}
	}
}

### 5 - Remnants
country_event = {
	id = dso_story.5
	title = story.5.name
	# First
	desc = {
		trigger = {
			NOT = { has_country_flag = StoryFirst }
		}
		text = story.5.desc
	}
	# Gestalt Consciousness
	desc = {
		trigger = { is_gestalt = yes }
		text = story.5.desc.gesta
	}
	# Xenophobe
	desc = {
		trigger = { is_xenophobe = yes }
		text = story.5.desc.phobe
	}
	# Xenophile
	desc = {
		trigger = { is_xenophile = yes }
		text = story.5.desc.phile
	}
	# Followup
	desc = {
		trigger = {
			OR = {
				has_country_flag = Story1
				has_country_flag = Story2
				has_country_flag = Story3
				has_country_flag = Story4
			}
		}
		text = story.5.desc.followup
	}
	picture = GFX_evt_news_room
	show_sound = event_scanner
	is_triggered_only = yes
	trigger = {
		NOR = {
			has_country_flag = Story5
			has_country_flag = Story6
			has_country_flag = Story7
		}
	}
	immediate = {
		if = {
			limit = {
				NOT = { has_country_flag = StoryFirst }
			}
			set_country_flag = StoryFirst
		}
		if = {
			limit = {
				NOT = { has_country_flag = first_alien_life }
			}
			set_country_flag = first_alien_life
		}
		set_country_flag = Story5
	}
	option = { name = REMARKABLE }
	after = {
		hidden_effect = {
			country_event = { id = first_contact.1060 days = 10 random = 10 }
		}
	}
}

######################################
# Ancient Gray Tempest Micro-missles #
######################################
# TODO!!
# From = fleet?
#country_event = {
#	id = dso_story.6
#	title = dso_story.6.name
#	# First
#	desc = {
#		# trigger = {
#		# 	OR = {
#		# 		has_origin = civic_gateway_pursuer
#		# 		has_origin = civic_harvester_nanites
#		# 	}
#		# }
#		text = story.6.desc.nanite
#	}
#	# Gestalt Consciousness
#	desc = {
#		exclusive_trigger = {
#			is_gestalt = yes
#3			NOT = {
#				has_origin = civic_gateway_pursuer
#				has_origin = civic_harvester_nanites
#			}
#		}
#		text = story.6.desc.gesta
#	}
#	# Materialist
#	desc = {
#		trigger = { is_materialist = yes }
#		text = story.6.desc.materialist
#	}
#	# Gateway Guardian
#	desc = {
#		trigger = { has_origin = civic_gateway_worshiper }
#		text = story.6.desc.gateway_guardian
#	}
#	# other
#	desc = {
#		trigger = {
#			NOR = {
#				has_origin = civic_gateway_worshiper
#				has_origin = civic_gateway_pursuer
#				has_origin = civic_harvester_nanites
#				is_gestalt = yes
#				is_materialist = yes
#			}
#		}
#		text = story.6.desc.followup
#	}
#	picture = GFX_evt_news_room
#	show_sound = event_scanner
#	is_triggered_only = yes
#	trigger = { }
#	immediate = { }
#	option = { name = REMARKABLE }
#	after = {
#		hidden_effect = {
#			country_event = { id = first_contact.1060 days = 10 random = 10 }
#		}
#	}
#}

#
fleet_event = {
	id = DSO_ancrel.1
	title = "nanite_insight"
	desc = "DSO_ancrel.1.desc"
	picture = GFX_evt_drifting_gateway
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	option = {
		name = DSO_ancrel.1.a
	}
}
fleet_event = {
	id = DSO_ancrel.2
	title = "nanite_insight"
	desc = "DSO_ancrel.1.desc"
	picture = GFX_evt_drifting_gateway
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	option = {
		name = DSO_ancrel.1.a
	}
}
fleet_event = {
	id = DSO_ancrel.3
	title = "nanite_insight"
	desc = "DSO_ancrel.1.desc"
	picture = GFX_evt_drifting_gateway
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	option = {
		name = DSO_ancrel.1.a
		if = {
			limit = { has_ancrel = yes }
			owner = {
				add_tech_progress = { tech = tech_archaeo_missiles progress = 0.14 }
			}
		}
	}
}
fleet_event = {
	id = DSO_ancrel.4
	title = "nanite_insight"
	desc = "DSO_ancrel.1.desc"
	picture = GFX_evt_drifting_gateway
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	option = {
		name = DSO_ancrel.1.a
	}
}
fleet_event = {
	id = DSO_ancrel.5
	title = "nanite_insight"
	desc = "DSO_ancrel.1.desc"
	picture = GFX_evt_drifting_gateway
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	option = {
		name = DSO_ancrel.1.a
	}
}
#
fleet_event = {
	id = DSO_ancrel.6
	title = "nanite_insight"
	desc = "DSO_ancrel.2.desc"
	picture = GFX_evt_drifting_gateway
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	option = { name = DSO_ancrel.2.a }
}


##########################
#End of the Cult's Schism#
##########################

### Radical Cult
country_event = {
	id = dso_story.200
	title = "dso_story.200.name"
	desc = "dso_story.200.desc"
	picture = GFX_evt_alien_propaganda
	show_sound = event_ship_thrusters
	location = event_target:dessanu_cult_schism_ship
	event_chain = dso_story_dessanu_cult_schism

	is_triggered_only = yes

	immediate = {
		if = {
			limit = { is_ai = no }
			set_country_flag = starting_event
			save_event_target_as = owner_country
			random_system = {
				limit = {
					distance = {
						source = ROOT.capital_star
						use_bypasses = no
						min_jumps = 1
						max_jumps = 1
					}
					NOR = {
						exists = space_owner
						has_star_flag = hostile_system
						is_star_class = sc_black_hole
					}
				}
				random_system_planet = {
					limit = {
						is_capital = no
						is_asteroid = no
						is_star = no
						is_moon = no
						NOT = { is_planet_class = pc_gas_giant }
					}
					save_event_target_as = dessanu_cult_schism_hijacked_fleet_planet
				}
				set_star_flag = hostile_system
				set_star_flag = dessanu_cult_schism_hijacked_fleet_planet_flag
			}
			owner_species = { save_event_target_as = DSO_owner_species }
			random_country = {
				limit = { has_origin = civic_gateway_worshiper }
				if = { 
					limit = { has_global_flag = ethic_civic_classic_active }
					create_country = {
						name = "dso_story_dessanu_cult_schism_names"
						species = event_target:DSO_owner_species
						type = dso_cult_of_the_open_gate
						flag = {
							icon = {
								category = "imperial"
								file = "imperial_06.dds"
							}
							background = {
								category = "backgrounds"
								file = "double_hemispheres.dds"
							}
							colors = {
								"dark_grey"
								"light_orange"
								"null"
								"null"
							}
						}
						name_list = PREV
						auto_delete = no
						ignore_initial_colony_error = yes
						ethos = {
							ethic = "ethic_fanatic_spiritualist"
							ethic = "ethic_fanatic_xenophobe"
							ethic = "ethic_pacifist"
						}
						authority = auth_oligarchic
						civics= {
							#Distant Stars Overhaul w/ Ethics and Civics Classic
							civic = "civic_exalted_priesthood"
							civic = "civic_inwards_perfection"
							civic = "civic_chosen_people"
						}
						effect = {
							room_name_override = personality_evangelizing_zealots_room
							set_country_flag = dso_story_dessanu_cult_schism
							establish_communications_no_message = PREV
							establish_contact = { who = PREV location = PREV.capital_scope }
							#give_technology = { tech = "HYPER_DRIVE_3" message = no }
							#give_technology = { tech = "SENSOR_4" message = no }
							#give_technology = { tech = "COMBAT_COMPUTER_PICKET_ADVANCED" message = no }
							#give_technology = { tech = "DESTROYER_ZERO_POINT_REACTOR" message = no }
							#give_technology = { tech = "DESTROYER_SHIP_THRUSTER_4" message = no }
							create_leader = {
								class = commander
								species = owner_main_species
								name = random
								skill = 4
							}
							create_fleet = {
								name = "NAME_Hijacked_Fleet"
								effect = {
									set_owner = prev
									create_ship_design = {
										design = "NAME_Dagger"
									}
									create_ship = {
										name = "NAME_Unyielding_Faith"
										design = last_created_design
									}
									create_ship = {
										name = "NAME_Holy_Avatar"
										design = last_created_design
									}
									create_ship = {
										name = "NAME_Divine_Fury"
										design = last_created_design
										effect = {
											set_ship_flag = dessanu_cult_schism_ship
											set_disable_at_health = 0.05
											save_event_target_as = dessanu_cult_schism_ship
										}
									}
									set_location = event_target:dessanu_cult_schism_hijacked_fleet_planet
									set_fleet_stance = aggressive
									set_aggro_range_measure_from = return_point
									set_aggro_range = 50
									assign_leader = last_created_leader
									queue_actions = {
										repeat = {
											wait = {
												duration = 100
											}
										}
									}
								}
							}
							add_ship_design = last_created_design
							save_event_target_as = dso_story_dessanu_cult_schism
							set_name = random
							set_country_flag = dessanu_cult_schism_rebels_of@root
						}
					}
					begin_event_chain = {
						event_chain = "dso_story_dessanu_cult_schism"
						target = ROOT
					}
				}
				else = {
					create_country = {
						name = "dso_story_dessanu_cult_schism_names"
						species = event_target:DSO_owner_species
						type = dso_cult_of_the_open_gate
						flag = {
							icon = {
								category = "imperial"
								file = "imperial_06.dds"
							}
							background = {
								category = "backgrounds"
								file = "double_hemispheres.dds"
							}
							colors = {
								"dark_grey"
								"light_orange"
								"null"
								"null"
							}
						}
						name_list = PREV
						auto_delete = no
						ignore_initial_colony_error = yes
						ethos = {
							ethic = "ethic_spiritualist"
							ethic = "ethic_xenophobe"
							ethic = "ethic_pacifist"
						}
						authority = auth_oligarchic
						civics= {
							#Distant Stars Overhaul w/ Ethics and Civics Classic
							civic = "civic_exalted_priesthood"
							civic = "civic_inwards_perfection"
							civic = "civic_chosen_people"
						}
						effect = {
							room_name_override = personality_evangelizing_zealots_room
							set_country_flag = dso_story_dessanu_cult_schism
							establish_communications_no_message = PREV
							establish_contact = { who = PREV location = PREV.capital_scope }
							create_leader = {
								class = commander
								species = owner_main_species
								name = random
								skill = 4
							}
							create_fleet = {
								name = "NAME_Hijacked_Fleet"
								effect = {
									set_owner = prev
									create_ship_design = {
										design = "NAME_Dagger"
									}
									create_ship = {
										name = "NAME_Unyielding_Faith"
										design = last_created_design
									}
									create_ship = {
										name = "NAME_Holy_Avatar"
										design = last_created_design
									}
									create_ship = {
										name = "NAME_Divine_Fury"
										design = last_created_design
										effect = {
											set_ship_flag = dessanu_cult_schism_ship
											set_disable_at_health = 0.05
											save_event_target_as = dessanu_cult_schism_ship
										}
									}
									set_location = event_target:dessanu_cult_schism_hijacked_fleet_planet
									set_fleet_stance = aggressive
									set_aggro_range_measure_from = return_point
									set_aggro_range = 50
									assign_leader = last_created_leader
									queue_actions = {
										repeat = {
											wait = {
												duration = 100
											}
										}
									}
								}
							}
							add_ship_design = last_created_design
							save_event_target_as = dso_story_dessanu_cult_schism
							set_name = random
							set_country_flag = dessanu_cult_schism_rebels_of@root
						}
					}
					begin_event_chain = {
						event_chain = "dso_story_dessanu_cult_schism"
						target = ROOT
					}
				}
				last_created_country = {
					set_name = NAME_dso_story_dessanu_cult_schism
					set_adjective = NAME_dso_story_dessanu_cult_schism_ADJ
				}
				every_system = {
					limit = { any_system_planet = { is_planet = event_target:dessanu_cult_schism_hijacked_fleet_planet } } 
					create_starbase = {
						owner = last_created_country
						size = starbase_outpost
						effect = { set_starbase_flag = dessanu_cult_schism_hijacked_fleet_planet_flag }
					}
				}
			}
		}
		else = { }
	}

	option = {
		name = "dso_story.200.a"
		if = {
			limit = { is_ai = no }
			tooltip = {
				begin_event_chain = {
					event_chain = "dso_story_dessanu_cult_schism"
					target = ROOT
				}
			}
			hidden_effect = {
				create_point_of_interest = {
					id = dso_story_dessanu_cult_schism_poi.1
					name = "dessanu_cult_schism_hijacked_cult_fleet_poi"
					desc = "dessanu_cult_schism_hijacked_cult_fleet_poi_desc"
					event_chain = "dso_story_dessanu_cult_schism"
					location = event_target:dessanu_cult_schism_ship
				}
			}
		}
		else = {}
		last_created_country = {
			declare_war = {
				target = ROOT
				name = {
					key = "NAME_dso_cult_of_the_open_gate_schism_war"
					variable_string = "[this.MainDefender.GetAdj]"
				}
				attacker_war_goal = "wg_dso_gateway_orthodoxy_civil_war_att"
			}
		}
	}
}

# Ship Disabled (HIDDEN)
ship_event = {
	id = dso_story.201
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		has_ship_flag = dessanu_cult_schism_ship
		owner = { has_country_flag = dessanu_cult_schism_rebels_of@from.owner }
	}

	immediate = {
		FROM = { owner = { country_event = { id = dso_story.202 } } }
	}
}

# Ship Disabled
country_event = {
	id = dso_story.202
	title = "dso_story.202.name"
	desc = "dso_story.202.desc"
	picture = GFX_evt_sabotaged_ship
	show_sound = event_space_battle
	location = FROM
	trackable = yes
	event_chain = dso_story_dessanu_cult_schism

	is_triggered_only = yes

	immediate = {
		FROM = { save_event_target_as = disabled_dessanu_cult_schism_ship }
	}

	option = {
		name = "dso_story.202.a"
		from = {
			create_ambient_object = {
				type = small_debris_object
				scale = 0.1
				effect = { #unused, but leaving it in to show people it's now possible...
					set_ambient_object_flag = dessanu_cult_schism_ship_debris
					save_event_target_as = dessanu_cult_schism_ship_debris
				}
			}
			enable_special_project = {
				name = "BOARD_HERETIC_SHIP_1"
				location = event_target:dessanu_cult_schism_ship_debris
				owner = root
			}
		}
		hidden_effect = {
			remove_point_of_interest = dso_story_dessanu_cult_schism_poi.1
		}
	}
}

# Ship Disabled By Someone Else (HIDDEN)
ship_event = {
	id = dso_story.217
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		has_ship_flag = dessanu_cult_schism_ship
		owner = {
			NOT = { has_country_flag = dessanu_cult_schism_rebels_of@from.owner }
		}
	}

	immediate = {
		random_playable_country = {
			limit = {
				root = {
					owner = { has_country_flag = dessanu_cult_schism_rebels_of@prevprev }
				}
			}
			country_event = { id = dso_story.218 }
		}
	}
}

# Ship Disabled By Someone Else
country_event = {
	id = dso_story.218
	title = "dso_story.218.name"
	desc = "dso_story.218.desc"
	picture = GFX_evt_sabotaged_ship
	show_sound = event_space_battle
	location = FROM
	trackable = yes
	event_chain = dso_story_dessanu_cult_schism

	is_triggered_only = yes

	immediate = {
		FROM = { save_event_target_as = disabled_dessanu_cult_schism_ship }
	}

	option = {
		name = "dso_story.202.a"
		hidden_effect = { remove_point_of_interest = dso_story_dessanu_cult_schism_poi.1 }
		from = {
			create_ambient_object = {
				type = small_debris_object
				scale = 0.1
				effect = {
					set_ambient_object_flag = dessanu_cult_schism_ship_debris
					save_event_target_as = dessanu_cult_schism_ship_debris
				}
			}
			enable_special_project = {
				name = "BOARD_HERETIC_SHIP_1"
				location = event_target:dessanu_cult_schism_ship_debris
				owner = root
			}
		}
	}
}

# Ship Boarded
ship_event = {
	id = dso_story.203
	title = "dso_story.203.name"
	desc = "dso_story.203.desc"
	picture = GFX_evt_interior_battle
	show_sound = event_ground_battle
	event_chain = dso_story_dessanu_cult_schism

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			owner = {
				remove_point_of_interest = dso_story_dessanu_cult_schism_poi.1
				capital_scope = { save_event_target_as = capital }
				set_country_flag = searching_for_dso_story_dessanu_heretics
			}
			fromfrom = {
				owner = { save_event_target_as = cult_name }
				fleet = { destroy_fleet = this }
			}
			random_system = {
				limit = {
					distance = {
						source = event_target:capital
						use_bypasses = no
						min_jumps = 1
						max_jumps = 3
					}
					NOR = {
						exists = space_owner
						has_star_flag = hostile_system
						is_star_class = sc_black_hole
					}
				}
				save_event_target_as = dso_story_dessanu_heretics_1
				set_star_flag = dso_story_dessanu_heretics_1
			}
			random_system = {
				limit = {
					distance = {
						source = event_target:capital
						use_bypasses = no
						min_jumps = 1
						max_jumps = 3
					}
					NOR = {
						exists = space_owner
						has_star_flag = dso_story_dessanu_heretics_1
						has_star_flag = hostile_system
						is_star_class = sc_black_hole
					}
				}
				save_event_target_as = dso_story_dessanu_heretics_2
				set_star_flag = dso_story_dessanu_heretics_2
			}
			random_system = {
				limit = {
					distance = {
						source = event_target:capital
						use_bypasses = no
						min_jumps = 1
						max_jumps = 3
					}
					NOR = {
						exists = space_owner
						has_star_flag = dso_story_dessanu_heretics_1
						has_star_flag = dso_story_dessanu_heretics_2
						has_star_flag = hostile_system
						is_star_class = sc_black_hole
					}
				}
				save_event_target_as = dso_story_dessanu_heretics_3
				set_star_flag = dso_story_dessanu_heretics_3
			}
			owner = {
				create_point_of_interest = {
					id = dessanu_cult_schism_search_poi.1
					name = "dessanu_cult_schism_search_1_poi"
					desc = "dessanu_cult_schism_search_1_poi_desc"
					event_chain = "dso_story_dessanu_cult_schism"
					location = event_target:dso_story_dessanu_heretics_1
				}
				create_point_of_interest = {
					id = dessanu_cult_schism_search_poi.2
					name = "dessanu_cult_schism_search_2_poi"
					desc = "dessanu_cult_schism_search_1_poi_desc"
					event_chain = "dso_story_dessanu_cult_schism"
					location = event_target:dso_story_dessanu_heretics_2
				}
				create_point_of_interest = {
					id = dessanu_cult_schism_search_poi.3
					name = "dessanu_cult_schism_search_3_poi"
					desc = "dessanu_cult_schism_search_1_poi_desc"
					event_chain = "dso_story_dessanu_cult_schism"
					location = event_target:dso_story_dessanu_heretics_3
				}
			}
			#random_country = {
			#	limit = { has_origin = civic_gateway_worshiper }
			#	country_event = { id = dso_story.202 days = 15 }
			#}
		}
	}

	option = {
		name = "dso_story.203.a"
		random_country = {
			limit = { has_origin = civic_gateway_worshiper }
			custom_tooltip = dso_story_203_a_tooltip
			hidden_effect = { 
				random_country = {
					limit = { is_country_type = dso_cult_of_the_open_gate }
					random_owned_starbase = {
						limit = { has_starbase_flag = dessanu_cult_schism_hijacked_fleet_planet_flag }
						set_owner = PREVPREV
						remove_starbase_flag = dessanu_cult_schism_hijacked_fleet_planet_flag
					}
				}
			}
		}
	}
}

# Cultist Discovered a Dessanu War Relic
country_event = {
	id = dso_story.230
	title = "dso_story.230.name"
	desc = "dso_story.230.desc"
	picture = GFX_evt_news_room
	show_sound = event_planetary_riot
	location = home_planet
	trackable = yes
	event_chain = dso_story_dessanu_cult_schism

	is_triggered_only = yes

	option = {
		name = "dso_story.230.a"
		
	}
}

# Cultist Ships Sighted 1
fleet_event = {
	id = dso_story.204
	title = "dso_story.204.name"
	desc = "dso_story.204.desc"
	picture = GFX_evt_small_space_battle
	show_sound = event_red_alert
	location = ROOT
	event_chain = dso_story_dessanu_cult_schism

	is_triggered_only = yes

	trigger = {
		owner = {
			has_country_flag = searching_for_dso_story_dessanu_heretics
			NOT = { has_country_flag = dso_story_dessanu_heretics_sighted_1 }
		}
		from = { has_star_flag = dso_story_dessanu_heretics_1 }
	}

	immediate = {
		owner = {
			save_event_target_as = owner_country
			set_country_flag = dso_story_dessanu_heretics_sighted_1
		}
		from = {
			random_system_planet = {
				limit = {
					is_capital = no
					is_asteroid = no
					is_star = no
				}
				save_event_target_as = dessanu_cult_schism_marauder_planet
			}
		}
		owner = {
			random_country = {
				limit = { has_country_flag = dessanu_cult_schism_rebels_of@root.owner }
				save_event_target_as = dso_story_dessanu_cult_schism
				create_leader = {
					class = commander
					species = owner_main_species
					name = random
					skill = 2
				}
				create_fleet = {
					name = "NAME_dessanu_cult_schism_Marauders"
					effect = {
						set_owner = PREV
						create_ship_design = {
							design = "NAME_Dagger"
						}
						create_ship = {
							name = "NAME_Divine_Vessel"
							design = last_created_design
						}
						create_ship = {
							name = "NAME_Sacred_Might"
							design = last_created_design
						}
						create_ship = {
							name = "NAME_Heavenly_Portent"
							design = last_created_design
						}
						assign_leader = last_created_leader
						set_location = event_target:dessanu_cult_schism_marauder_planet
						set_fleet_stance = aggressive
						set_aggro_range_measure_from = self
						set_aggro_range = 500
						set_fleet_flag = dessanu_cult_schism_marauders
					}
				}
			}
		}
	}

	option = {
		name = "BATTLESTATIONS"
	}
}

# Cultist Ships Defeated (HIDDEN)
country_event = {
	id = dso_story.216
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		exists = fromfromfrom
		FROMFROMFROM = { has_fleet_flag = dessanu_cult_schism_marauders }
	}

	immediate = {
		FROMFROMFROM = { solar_system = { save_event_target_as = dso_marauder_system } }
		random_country = {
			limit = {
				from = { has_country_flag = dessanu_cult_schism_rebels_of@prev }
			}
			save_event_target_as = dessanu_cult_schism_target
			change_variable = {
				which = "dessanu_cult_schism_fleets_destroyed"
				value = 1
			}
			if = {
				limit = {
					check_variable = {
						which = "dessanu_cult_schism_fleets_destroyed"
						value < 3
					}
				}
				country_event = { id = dso_story.219 }
			}
			if = {
				limit = {
					check_variable = {
						which = "dessanu_cult_schism_fleets_destroyed"
						value > 2
					}
				}
				country_event = { id = dso_story.207 }
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					solar_system = { has_star_flag = dso_story_dessanu_heretics_1 }
				}
			}
			event_target:dessanu_cult_schism_target = { remove_point_of_interest = dessanu_cult_schism_search_poi.1 }
			FROMFROMFROM = {
				solar_system = {
					remove_star_flag = dso_story_dessanu_heretics_1
				}
			}
		}
		else_if = {
			limit = {
				FROMFROMFROM = {
					solar_system = { has_star_flag = dso_story_dessanu_heretics_2 }
				}
			}
			event_target:dessanu_cult_schism_target = { remove_point_of_interest = dessanu_cult_schism_search_poi.2 }
			FROMFROMFROM = {
				solar_system = {
					remove_star_flag = dso_story_dessanu_heretics_2
				}
			}
		}
		else_if = {
			limit = {
				FROMFROMFROM = {
					solar_system = { has_star_flag = dso_story_dessanu_heretics_3 }
				}
			}
			event_target:dessanu_cult_schism_target = { remove_point_of_interest = dessanu_cult_schism_search_poi.3 }
			FROMFROMFROM = {
				solar_system = {
					remove_star_flag = dso_story_dessanu_heretics_3
				}
			}
		}
	}
}

# Cultist Fleet Destroyed
country_event = {
	id = dso_story.219
	title = "dso_story.219.name"
	desc = "dso_story.219.desc"
	picture = GFX_evt_exploding_ship
	show_sound = event_space_battle
	location = event_target:dso_marauder_system
	event_chain = dso_story_dessanu_cult_schism

	is_triggered_only = yes

	option = {
		name = "GOOD"
	}
}

# Cultist Ships Sighted 2
fleet_event = {
	id = dso_story.205
	title = "dso_story.204.name"
	desc = "dso_story.205.desc"
	picture = GFX_evt_small_space_battle
	show_sound = event_red_alert
	location = ROOT
	event_chain = dso_story_dessanu_cult_schism

	is_triggered_only = yes

	trigger = {
		owner = {
			has_country_flag = searching_for_dso_story_dessanu_heretics
			NOT = { has_country_flag = dso_story_dessanu_heretics_sighted_2 }
		}
		from = { has_star_flag = dso_story_dessanu_heretics_2 }
	}

	immediate = {
		owner = {
			save_event_target_as = owner_country
			set_country_flag = dso_story_dessanu_heretics_sighted_2
		}
		from = {
			random_system_planet = {
				limit = {
					#is_capital = no
					#is_asteroid = no
					is_star = no
				}
				save_event_target_as = dessanu_cult_schism_marauder_planet
			}
		}
		owner = {
			random_country = {
				limit = { has_country_flag = dessanu_cult_schism_rebels_of@root.owner }
				save_event_target_as = dso_story_dessanu_cult_schism
				create_leader = {
					class = commander
					species = owner_main_species
					name = random
					skill = 2
					traits = {
					}
				}
				create_fleet = {
					name = "NAME_dessanu_cult_schism_Marauders"
					effect = {
						set_owner = PREV
						create_ship_design = {
							design = "NAME_Dagger"
						}
						create_ship = {
							name = "NAME_Heavenly_Judgment"
							design = last_created_design
						}
						create_ship = {
							name = "NAME_Revered_Elder"
							design = last_created_design
						}
						create_ship = {
							name = "NAME_Wrath_of_the_Spirits"
							design = last_created_design
						}
						create_ship = {
							name = "NAME_Bane_of_the_Heretic"
							design = last_created_design
						}
						assign_leader = last_created_leader
						set_location = event_target:dessanu_cult_schism_marauder_planet
						set_fleet_stance = aggressive
						set_aggro_range_measure_from = self
						set_aggro_range = 500
						set_fleet_flag = dessanu_cult_schism_marauders
					}
				}
			}
		}
	}

	option = {
		name = "BATTLESTATIONS"
	}
}

# Cultist Ships Sighted 3
fleet_event = {
	id = dso_story.206
	title = "dso_story.204.name"
	desc = "dso_story.206.desc"
	picture = GFX_evt_small_space_battle
	show_sound = event_red_alert
	location = ROOT
	event_chain = dso_story_dessanu_cult_schism

	auto_opens = yes
	is_triggered_only = yes

	trigger = {
		owner = {
			has_country_flag = searching_for_dso_story_dessanu_heretics
			NOT = { has_country_flag = dso_story_dessanu_heretics_sighted_3 }
		}
		from = { has_star_flag = dso_story_dessanu_heretics_3 }
	}

	immediate = {
		owner = {
			set_country_flag = dso_story_dessanu_heretics_sighted_3
			save_event_target_as = owner_country
		}
		from = {
			random_system_planet = {
				limit = {
					is_capital = no
					is_asteroid = no
					is_star = no
				}
				save_event_target_as = dessanu_cult_schism_marauder_planet
			}
		}
		random_country = {
			limit = { has_country_flag = dessanu_cult_schism_rebels_of@root.owner }
			save_event_target_as = dso_story_dessanu_cult_schism
			create_leader = {
				class = commander
				species = owner_main_species
				name = random
				skill = 2
			}
			create_fleet = {
				name = "NAME_dessanu_cult_schism_Marauders"
				effect = {
					set_owner = PREV
					create_ship_design = {
						design = "NAME_Dagger"
					}
					create_ship = {
						name = "NAME_Heathens_Doom"
						design = last_created_design
					}
					create_ship = {
						name = "NAME_Infidel_Slayer"
						design = last_created_design
					}
					create_ship = {
						name = "NAME_Pious_Crusader"
						design = last_created_design
					}
					create_ship_design = {
						design = "NAME_dso_dessanu_small_ship_fallen_empire"
					}
					create_ship = {
						name = "NAME_Temple_of_Light"
						design = last_created_design
					}
					assign_leader = last_created_leader
					set_location = event_target:dessanu_cult_schism_marauder_planet
					set_fleet_flag = dessanu_cult_schism_marauders
					set_fleet_stance = aggressive
					set_aggro_range_measure_from = self
					set_aggro_range = 500
				}
			}
		}
	}

	option = {
		name = "BATTLESTATIONS"
	}
}

# Cultist Marauders Defeated
country_event = {
	id = dso_story.207
	title = "dso_story.207.name"
	desc = "dso_story.207.desc"
	picture = GFX_evt_exploding_ship
	show_sound = event_space_battle
	trackable = yes
	event_chain = dso_story_dessanu_cult_schism

	is_triggered_only = yes

	immediate = {
		remove_country_flag = searching_for_dso_story_dessanu_heretics
		fromfromfrom = {
			save_event_target_as = our_fleet
			solar_system = {
				save_event_target_as = our_fleet_position #used for loc purposes
				set_star_flag = dessanu_cult_schism_debris_system
				create_ambient_object = {
					type = "abandoned_ship_object"
				}
				random_system_ambient_object = {
					limit = { is_same_value = last_created_ambient_object }
					set_location = {
						target = event_target:our_fleet
						distance = 2
						angle = random
					}
					set_ambient_object_flag = dessanu_cult_schism_debris_object
					enable_special_project = {
						name = HERETIC_DEBRIS
						location = this
						owner = root
					}
				}
			}
			from = { save_event_target_as = enemy_fleet_position }
		}
		random_country = {
			limit = { has_country_flag = dessanu_cult_schism_rebels_of@root }
			save_event_target_as = dso_story_dessanu_cult_schism
		}
	}

	option = {
		name = "dso_story.207.a"
		custom_tooltip = dso_story.207.a.tooltip
	}
}

# Debris Investigated
country_event = {
	id = dso_story.208
	title = "dso_story.208.name"
	desc = {
		trigger = {
			OR = {
				any_system_within_border = { has_star_flag = dso_story_dessanu_cult_schism_gray_goo_system }
				any_system = { 
					has_star_flag = dso_story_dessanu_cult_schism_gray_goo_system
					any_ship_in_system = { is_owned_by = ROOT }
				}
			}
		}
		text = dso_story.208.desc_2
	}
	desc = {
		trigger = {
			always = yes 
		}
		text = dso_story.208.desc
	}
	picture = GFX_evt_space_station
	show_sound = event_radio_chatter
	event_chain = dso_story_dessanu_cult_schism

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			random_system = {
				limit = { has_star_flag = dessanu_cult_schism_debris_system }
				remove_star_flag = dessanu_cult_schism_debris_system
				random_system_ambient_object = {
					limit = { has_ambient_object_flag = dessanu_cult_schism_debris_object }
					destroy_ambient_object = this
				}
			}
			random_country = {
				limit = { has_country_flag = dessanu_cult_schism_rebels_of@root }
				save_event_target_as = dso_story_dessanu_cult_schism
			}
			save_event_target_as = owner_country
			capital_scope = { save_event_target_as = capital }
			if = {
				limit = {
					NOT = { exists = event_target:our_fleet }
				}
				ordered_owned_fleet = {
					limit = {
						NOT = {
							is_ship_class = shipclass_starbase
						}
					}
					position = 0
					order_by = trigger:fleet_power
					save_event_target_as = our_fleet
				}
			}
			event_target:our_fleet.solar_system = {
				random_system = {
					limit = {
						has_star_flag = dso_story_dessanu_cult_schism_gray_goo_system
					}
					random_system_planet = {
						limit = { is_planet_class = pc_gray_goo }
						save_event_target_as = dso_story_dessanu_cult_schism_planet
					}
					if = {
						limit = { has_owner = no }
						create_starbase = {
							owner = event_target:dso_story_dessanu_cult_schism
							size = starbase_outpost
							effect = { set_starbase_flag = dso_story_dessanu_cult_schism_gray_goo_system_flag }
						}
					}
				}
			}
			event_target:dso_story_dessanu_cult_schism = {
				create_fleet = {
					name = "NAME_dessanu_cult_schism_Shipyard"
					effect = {
						set_owner = PREV
						create_ship = {
							name = "NAME_dessanu_cult_schism_Shipyard"
							design = "NAME_Citadel"
						}
						set_location = event_target:dso_story_dessanu_cult_schism_planet
						set_fleet_flag = dso_story_dessanu_cult_schism_shipyard
						save_event_target_as = dso_story_dessanu_cult_schism_shipyard
					}
				}
				create_leader = {
					class = commander
					species = owner_main_species
					name = random
					skill = 2
				}
				create_fleet = {
					name = "NAME_Cult_Defense_Fleet"
					effect = {
						set_owner = PREV
						create_ship_design = {
							design = "NAME_Dagger"
						}
						create_ship = {
							name = "NAME_Final_Judgment"
							design = last_created_design
						}
						create_ship = {
							name = "NAME_The_Chosen_One"
							design = last_created_design
						}
						create_ship = {
							name = "NAME_Eternal_Damnation"
							design = last_created_design
						}
						create_ship_design = {
							design = "NAME_dso_dessanu_small_ship_fallen_empire"
						}
						create_ship = {
							name = "NAME_Path_of_the_Pilgrim"
							design = last_created_design
						}
						assign_leader = last_created_leader
						set_location = event_target:dso_story_dessanu_cult_schism_planet
						set_fleet_stance = aggressive
						set_aggro_range_measure_from = self
						set_aggro_range = 300
						queue_actions = {
							repeat = {
								wait = {
									duration = 100
								}
							}
						}
					}
				}
			}
			create_point_of_interest = {
				id = dessanu_cult_schism_shipyard_poi.1
				name = "dessanu_cult_schism_shipyard_poi"
				desc = "dessanu_cult_schism_shipyard_poi_desc"
				event_chain = "dso_story_dessanu_cult_schism"
				location = event_target:dso_story_dessanu_cult_schism_shipyard
			}
		}
	}

	option = {
		name = "dso_story.208.a"
	}
}

# Shipyard Destroyed (HIDDEN)
country_event = {
	id = dso_story.215
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		exists = fromfromfrom
		FROMFROMFROM = { has_fleet_flag = dso_story_dessanu_cult_schism_shipyard }
		FROM = { has_country_flag = dessanu_cult_schism_rebels_of@root }
	}

	immediate = {
		remove_point_of_interest = dessanu_cult_schism_shipyard_poi.1
		country_event = { id = dso_story.209 }
	}
}

# Shipyard Destroyed
country_event = {
	id = dso_story.209
	title = "dso_story.209.name"
	desc = "dso_story.209.desc"
	picture = GFX_evt_exploding_ship
	show_sound = event_space_battle
	event_chain = dso_story_dessanu_cult_schism

	is_triggered_only = yes

	immediate = {
		FROMFROM = { save_event_target_as = dso_story_dessanu_cult_schism }
	}

	option = {
		name = "dso_story.209.a"
		hidden_effect = {
			country_event = { id = dso_story.210 days = 150 random = 50 }
		}
		add_monthly_resource_mult = {
			resource = engineering_research
			value = @tier3researchreward
			min = @tier3researchmin
			max = @tier3researchmax
		}
		random_country = {
			limit = { has_origin = civic_gateway_worshiper }
			custom_tooltip = dso_story_203_a_tooltip
			hidden_effect = { 
				random_country = {
					limit = { is_country_type = dso_cult_of_the_open_gate }
					random_owned_starbase = {
						limit = { has_starbase_flag = dso_story_dessanu_cult_schism_gray_goo_system_flag }
						set_owner = PREVPREV
						remove_starbase_flag = dso_story_dessanu_cult_schism_gray_goo_system_flag
					}
				}
			}
		}
	}
}

# Shipyard Destroyed By Someone Else (HIDDEN)
country_event = {
	id = dso_story.220
	hide_window = yes

	fire_only_once = yes
	is_triggered_only = yes

	trigger = {
		FROMFROM = { has_fleet_flag = dso_story_dessanu_cult_schism_shipyard }
		NOT = { has_country_flag = dessanu_cult_schism_rebels_of@from }
	}

	immediate = {
		random_country = {
			limit = {
				root = { has_country_flag = dessanu_cult_schism_rebels_of@prev }
			}
			country_event = { id = dso_story.221 }
			remove_point_of_interest = dessanu_cult_schism_shipyard_poi.1
		}
	}
}

# Shipyard Destroyed By Someone Else
country_event = {
	id = dso_story.221
	title = "dso_story.209.name"
	desc = "dso_story.221.desc"
	picture = GFX_evt_exploding_ship
	show_sound = event_space_battle
	event_chain = dso_story_dessanu_cult_schism

	is_triggered_only = yes

	immediate = {
		FROM = { save_event_target_as = dso_story_dessanu_cult_schism }
	}

	option = {
		name = "dso_story.209.a"
		hidden_effect = {
			country_event = { id = dso_story.210 days = 150 random = 50 }
		}
	}
}

# Flagship Detected
country_event = {
	id = dso_story.210
	title = "dso_story.210.name"
	desc = {
		trigger = {
			OR = {
				any_system_within_border = { has_star_flag = cult_of_the_open_gate_system }
				any_system = { 
					has_star_flag = cult_of_the_open_gate_system
					any_ship_in_system = { is_owned_by = ROOT }
				}
			}
		}
		text = dso_story.210.desc_2
	}
	desc = {
		trigger = {
			always = yes 
		}
		text = dso_story.210.desc
	}
	picture = GFX_evt_ship_in_orbit
	show_sound = event_red_alert
	event_chain = dso_story_dessanu_cult_schism

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			set_country_flag = hunting_dessanu_cult_schism_flagship
			capital_scope = { save_event_target_as = capital }
			random_system = {
				limit = { has_star_flag = cult_of_the_open_gate_system }
				save_event_target_as = dso_story_dessanu_cult_schism_flagship_system
				set_star_flag = dso_story_dessanu_cult_schism_flagship_system
				if = {
					limit = { has_owner = no } 
					random_country = {
						limit = { is_country_type = dso_cult_of_the_open_gate }
						PREV = { 
							create_starbase = {
								owner = PREVPREV
								size = starbase_outpost
								effect = { set_starbase_flag = dessanu_cult_schism_hijacked_fleet_planet_flag }
							}
						}
					}
				}
			}
			create_point_of_interest = {
				id = dessanu_cult_schism_flagship_poi.1
				name = "dessanu_cult_schism_flagship_poi"
				desc = "dessanu_cult_schism_flagship_poi_desc"
				event_chain = "dso_story_dessanu_cult_schism"
				location = event_target:dso_story_dessanu_cult_schism_flagship_system
			}
		}
	}

	option = {
		name = "dso_story.210.a"
	}
}

# Cult Leader Signals
fleet_event = {
	id = dso_story.211
	title = "dso_story.211.name"
	desc = "dso_story.211.desc"

	diplomatic = yes
	auto_opens = yes

	is_triggered_only = yes

	trigger = {
		owner = { has_country_flag = hunting_dessanu_cult_schism_flagship }
		from = { has_star_flag = dso_story_dessanu_cult_schism_flagship_system }
	}

	picture_event_data = {
		portrait = event_target:dso_story_dessanu_cult_schism
		room = ethic_spaceship_room
	}

	immediate = {
		owner = {
			remove_country_flag = hunting_dessanu_cult_schism_cult_flagship
			save_event_target_as = shipowner
		}
		from = { remove_star_flag = dso_story_dessanu_cult_schism_flagship_system }
		hidden_effect = {
			from = {
				random_system_planet = {
					limit = {
						is_capital = no
						is_asteroid = no
						is_star = no
					}
					save_event_target_as = dessanu_cult_schism_flagship_planet
				}
			}
			owner = {
				random_country = {
					limit = { has_country_flag = dessanu_cult_schism_rebels_of@root.owner }
					save_event_target_as = dso_story_dessanu_cult_schism
					create_fleet = {
						name = "NAME_dessanu_cult_schism_Flagship"
						effect = {
							set_owner = PREV
							create_ship_design = {
								design = "NAME_Dagger"
							}
							create_ship = {
								name = "NAME_Glorious_Might"
								design = last_created_design
							}
							create_ship = {
								name = "NAME_Righteous_Zealot"
								design = last_created_design
							}
							create_ship = {
								name = "NAME_Holy_Protector"
								design = last_created_design
							}
							create_ship = {
								name = "NAME_Holy_Defender"
								design = last_created_design
							}
							create_ship = {
								name = "NAME_Divine_Justicar"
								design = last_created_design
							}
							create_ship_design = {
								design = "NAME_dso_dessanu_small_ship_fallen_empire"
							}
							create_ship = {
								name = "NAME_Dawn_of_Creation"
								design = last_created_design
								effect = {
									set_ship_flag = dessanu_cult_schism_flagship
									set_disable_at_health = 0.05
								}
							}
							set_location = event_target:dessanu_cult_schism_flagship_planet
						}
					}
				}
			}
		}
	}

	option = {
		name = "dso_story.211.a"
	}
}

# Flagship Disabled (HIDDEN)
ship_event = {
	id = dso_story.212
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		has_ship_flag = dessanu_cult_schism_flagship
		owner = { has_country_flag = dessanu_cult_schism_rebels_of@from.owner }
	}

	immediate = {
		remove_ship_flag = dessanu_cult_schism_flagship
		owner = { save_event_target_as = dso_story_dessanu_cult_schism }
		FROM = {
			ship_event = { id = dso_story.213 }
			owner = { remove_point_of_interest = dessanu_cult_schism_flagship_poi.1 }
		}
	}
}

# Flagship Disabled
ship_event = {
	id = dso_story.213
	title = "dso_story.213.name"
	desc = "dso_story.213.desc"
	picture = GFX_evt_interior_battle
	show_sound = event_space_battle
	location = from
	trackable = yes
	event_chain = dso_story_dessanu_cult_schism

	is_triggered_only = yes

	immediate = {
		owner = { save_event_target_as = shipowner}
		FROM = {
			save_event_target_as = disabled_dessanu_cult_schism_flagship
			owner = { save_event_target_as = dso_story_dessanu_cult_schism }
		}
	}

	option = {
		name = "dso_story.213.a"
		from = {
			enable_special_project = {
				name = "BOARD_HERETIC_SHIP_2"
				location = this
				owner = event_target:shipowner
			}
		}
	}
}

# Flagship Disabled By Someone Else (HIDDEN)
ship_event = {
	id = dso_story.222
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		has_ship_flag = dessanu_cult_schism_flagship
		owner = {
			NOT = { has_country_flag = dessanu_cult_schism_rebels_of@from.owner }
		}
	}

	immediate = {
		solar_system = { save_event_target_as = dso_story_dessanu_cult_schism_flagship_system }
		random_country = {
			limit = {
				root.owner = { has_country_flag = dessanu_cult_schism_rebels_of@prev }
			}
			country_event = { id = dso_story.223 }
			remove_point_of_interest = dessanu_cult_schism_flagship_poi.1
		}
		fleet = { destroy_fleet = this }
	}
}

# Flagship Disabled By Someone Else
country_event = {
	id = dso_story.223
	title = "dso_story.223.name"
	desc = "dso_story.223.desc"
	picture = GFX_evt_exploding_ship
	show_sound = event_space_battle
	event_chain = dso_story_dessanu_cult_schism

	is_triggered_only = yes

	option = {
		name = "GOOD"
		end_event_chain = "dso_story_dessanu_cult_schism"
		hidden_effect = {
			capital_scope.solar_system = {
				random_system_ambient_object = {
					limit = { has_ambient_object_flag = dessanu_cult_schism_ship_debris }
					destroy_ambient_object = this
				}
			}
		}
		random_country = {
			limit = { is_country_type = dso_cult_of_the_open_gate }
			destroy_country = yes
		}
	}
}

# Flagship Boarded and Captured
country_event = {
	id = dso_story.214
	title = "dso_story.214.name"
	desc = "dso_story.214.desc"
	picture = GFX_evt_interior_battle
	show_sound = event_ground_battle
	location = fromfrom
	event_chain = dso_story_dessanu_cult_schism

	is_triggered_only = yes

	option = {
		name = "dso_story.214.a"
		end_event_chain = "dso_story_dessanu_cult_schism"
		hidden_effect = {
			capital_scope.solar_system = {
				random_system_ambient_object = {
					limit = { has_ambient_object_flag = dessanu_cult_schism_ship_debris }
					destroy_ambient_object = this
				}
			}
			fromfrom = {
				set_disabled = no
				set_name = random
				fleet = {
					set_owner = root
					set_name = "NAME_Ancient_Dessanu_Flagship"
				}
			}
			random_country = {
				limit = { is_country_type = dso_cult_of_the_open_gate }
				destroy_country = yes
			}
		}
	}
}

#############################################
#Odd Factory Clone - Ancient Dessanu Factory#
#############################################
planet_event = {
	id = dso_story.2015
	title = dso_story.2015.name
	#desc = {
	#	trigger = { NOT = { has_origin = civic_gateway_worshiper } }
	#	text =dso_story.2015.desc
	#}
	desc = {
		#trigger = { has_origin = civic_gateway_worshiper }
		text =dso_story.2015.desc_gateway_cult
	}
	picture = GFX_evt_alien_city
	show_sound = event_activating_unknown_technology
	location = root

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		is_occupied_flag = no
	}

	trigger = {
		owner = {
			NOR = {
				has_country_flag = dso_story_colony_odd_factory
				has_authority = auth_machine_intelligence
			}
		}
		num_pops > 0
		NOR = {
			has_planet_flag = colony_event
			is_planet_class = pc_ringworld_habitable
			is_planet_class = pc_shattered_ring_habitable
			is_planet_class = pc_habitat
		}
	}

	is_triggered_only = yes

	immediate = {
		set_planet_flag = colony_event
		owner = { set_country_flag = dso_story_colony_odd_factory }
		random_owned_pop = { unemploy_pop = yes }
		add_deposit = d_dessanu_relic_odd_factory
		random_list = {
			30 = { 
				if = { 
					limit = { OWNER = { has_government = gov_spiritualist_gateway_worshiper } }
					set_planet_flag = dso_story_colony_factory_no_effect
				}
				else = { set_planet_flag = dso_story_colony_factory_kidnap }
			}
			35 = { set_planet_flag = dso_story_colony_factory_no_effect }
		}
	}

	option = {
		name = INTRIGUING
		tooltip = { add_deposit = d_dessanu_relic_odd_factory }
	}
}
#Follow-up: Kidnap
planet_event = {
	id = dso_story.2016
	title = dso_story.2015.name
	desc = {
		trigger = { 
			NOT = {
				any_country = {
					NOT = { is_country = ROOT }
					has_established_contact = ROOT
					has_origin = civic_gateway_worshiper
				}
			}
		}
		text =dso_story.2016.desc
	}
	desc = {
		trigger = { 
			any_country = {
				NOT = { is_country = ROOT }
				has_established_contact = ROOT
				has_origin = civic_gateway_worshiper
			}
		}
		text =dso_story.2016.desc_gateway_cult
	}
	picture = GFX_evt_alien_city
	show_sound = event_ghost_town
	location = root

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
	}

	trigger = {
		has_planet_flag = dso_story_colony_factory_kidnap
		has_deposit = d_dessanu_relic_odd_factory
		num_assigned_jobs = {
			job = odd_factory_worker
			value >= 1
		}
	}

	mean_time_to_happen = {
		months = 4
	}

	immediate = {
		owner = { set_country_flag = odd_factory_pause }
		random_owned_pop = {
			limit = { has_job = odd_factory_worker }
			kill_pop = yes
		}
	}

	option = {
		name = dso_story.2016.b
		custom_tooltip = dso_story.2016.a.tooltip
		remove_deposit = d_dessanu_relic_odd_factory
		hidden_effect = {
			owner = { remove_country_flag = odd_factory_pause }
		}
	}

	option = {
		name = dso_story.2016.a
		custom_tooltip = dso_story.2016.a.tooltip
		hidden_effect = {
			remove_planet_flag = dso_story_colony_factory_kidnap
			owner = { remove_country_flag = odd_factory_pause }
			random_list = {
				50 = { set_planet_flag = dso_story_colony_factory_kidnap_sequel }
				50 = { set_planet_flag = dso_story_colony_factory_no_effect }
			}
		}
	}
}
#Follow-up: Kidnap 2
planet_event = {
	id = dso_story.2017
	title = dso_story.2015.name
	desc = dso_story.2017.desc
	picture = GFX_evt_alien_city
	show_sound = event_ghost_town
	location = root

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
	}

	trigger = {
		has_planet_flag = dso_story_colony_factory_kidnap_sequel
		has_deposit = d_dessanu_relic_odd_factory
		num_assigned_jobs = {
			job = odd_factory_worker
			value >= 1
		}
	}

	mean_time_to_happen = {
		months = 4
	}

	immediate = {
		owner = { set_country_flag = odd_factory_pause }
		random_owned_pop = {
			limit = { has_job = odd_factory_worker }
			kill_pop = yes
		}
	}

	option = {
		name = dso_story.2017.a
		custom_tooltip = dso_story.2017.a.tooltip
		add_modifier = {
			modifier = scared_population
			days = 1800
		}
		hidden_effect = {
			owner = { remove_country_flag = odd_factory_pause }
			remove_planet_flag = dso_story_colony_factory_kidnap_sequel
		}
	}
	option = {
		name = dso_story.2017.b
		custom_tooltip = dso_story.2017.b.tooltip
		add_modifier = {
			modifier = secured_factory
			days = 1800
		}
		hidden_effect = {
			owner = { remove_country_flag = odd_factory_pause }
			remove_planet_flag = dso_story_colony_factory_kidnap_sequel
		}
	}
}

#Follow-up: No effect
planet_event = {
	id = dso_story.2019
	title = dso_story.2015.name
	desc = dso_story.2019.desc
	picture = GFX_evt_alien_city
	show_sound = event_administrative_work
	location = root

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
	}

	trigger = {
		has_planet_flag = dso_story_colony_factory_no_effect
		has_deposit = d_dessanu_relic_odd_factory
		num_assigned_jobs = {
			job = odd_factory_worker
			value >= 1
		}
	}

	mean_time_to_happen = {
		months = 6
	}

	immediate = {
	}

	option = {
		name = GOOD
		hidden_effect = {
			remove_planet_flag = dso_story_colony_factory_no_effect
		}
	}
}
##Follow-up: Destroyed
#planet_event = {
#	id = dso_story.2020
#	title = dso_story.2015.name
#	desc = dso_story.2020.desc
#	picture = GFX_evt_burning_settlement
#	show_sound = event_structural_collapse
#	location = root
#
#	is_triggered_only = yes
#
#	trigger = {
#		NOT = { has_planet_flag = odd_factory_destroyed }
#	}
#
#	immediate = {
#		set_planet_flag = odd_factory_destroyed
#	}
#
#	option = {
#		name = dso_story.2018.a
#		add_deposit = d_odd_factory_wreckage_1
#		hidden_effect = {
#			remove_planet_flag = dso_story_colony_factory_found
#			remove_planet_flag = dso_story_colony_factory_no_effect
#			remove_planet_flag = dso_story_colony_factory_kidnap
#			remove_planet_flag = dso_story_colony_factory_kidnap_sequel
#			if = {
#				limit = {
#					has_modifier = secured_factory
#				}
#				remove_modifier = secured_factory
#			}
#			if = {
#				limit = {
#					has_modifier = scared_population
#				}
#				remove_modifier = scared_population
#			}
#		}
#	}
#	option = {
#		name = dso_story.2018.b
#		add_deposit = d_odd_factory_wreckage_2
#		hidden_effect = {
#			remove_planet_flag = dso_story_colony_factory_found
#			remove_planet_flag = dso_story_colony_factory_no_effect
#			remove_planet_flag = dso_story_colony_factory_breaks
#			remove_planet_flag = dso_story_colony_factory_kidnap
#			remove_planet_flag = dso_story_colony_factory_kidnap_sequel
#			if = {
#				limit = {
#					has_modifier = secured_factory
#				}
#				remove_modifier = secured_factory
#			}
#			if = {
#				limit = {
#					has_modifier = scared_population
#				}
#				remove_modifier = scared_population
#			}
#		}
#	}
#}